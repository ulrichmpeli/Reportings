%let an=16;%let mois=10;%let an1=16;%let mois1=09;%let identifiant=s623483;%let mdp=66ekjrna;%let chemin=//prnas01/3/chnrs5_dtvi/eQUIPES/Produits & Normes/Aubonnet_N - equipe/17 - Stats Produits/SAS/Etude/Import;*%let chemin=//prnas01/3/chnrs5_dtvi/eQUIPES/Produits & Normes/Bordeau_M/Stats produit;%let nom_fichier=support&an.&mois.;%let nom_feuille=base;%let dossier =/NAS/M/eQUIPES/Produits & Normes/Aubonnet_N - equipe/17 - Stats Produits/SAS/Etude/Import;*%let dossier =/NAS/M/eQUIPES/Produits & Normes/Bordeau_M/Stats produit;PROC IMPORT OUT=supportDATAFILE= "~&dossier./support&an1.&mois1..xls"DBMS=XLS REPLACE; GETNAMES=YES;RUN;/* On récupère les PM*/%macro recup_pm(an=,mois=,no_lancement=,pole=,table=); libname temp "/mutu/FR/batch/data/prod/IF12/VIE/I&pole.300/&table./M&an.&mois." access=readonly; data pm&no_lancement.; set temp.pms(keep=numctv codsup coduc resf codprod codsys); run;  %if &table. ne RCVPM %then %do; data mv&no_lancement.; set temp.mvs(keep=numctv codsup codprod codsys); run; %end;%mend;%recup_pm(an=&an.,mois=&mois.,no_lancement=1,pole=AA,table=VISTAINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=2,pole=CO,table=VISTAINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=3,pole=CU,table=VISTAINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=4,pole=RS,table=VISTAINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=5,pole=AA,table=VISDTINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=6,pole=AA,table=ILISINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=7,pole=CO,table=ILISINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=8,pole=CU,table=ILISINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=9,pole=RS,table=ILISINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=10,pole=AA,table=ILDTINV);*%recup_pm(an=&an.,mois=&mois.,no_lancement=11,pole=AA,table=RCVPM);*%recup_pm(an=&an.,mois=&mois.,no_lancement=12,pole=CO,table=RCVPM);*%recup_pm(an=&an.,mois=&mois.,no_lancement=13,pole=CU,table=RCVPM);%recup_pm(an=&an.,mois=&mois.,no_lancement=14,pole=AA,table=AGIPI);%recup_pm(an=&an.,mois=&mois.,no_lancement=15,pole=CO,table=AGIPI);data pm;set pm1 pm2 pm3 pm4 pm5 pm6 pm7 pm8 pm9 pm10 /*pm11 pm12 pm13*/ pm14 pm15;run;data mv;set mv1 mv2 mv3 mv4 mv5 mv6 mv7 mv8 mv9 mv10 mv14 mv15;run;proc sort data=pm nodupkey out=pmbis;by codsup;run;proc sort data=mv nodupkey out=mvbis;by codsup;run;data sup(keep=codsup);set pmbis mvbis;run;proc sort data=sup nodupkey;by codsup;run;proc sort data=support nodupkey;by codsup;run;data pm_2;merge sup(in=a) support(in=b);by codsup;if a or b;run;/*PROC EXPORT DATA=pm_2OUTFILE= "~/NAS/M/eQUIPES/Produits & Normes/Aubonnet_N - equipe/17 - Stats Produits/SAS/Etude/Import/support&an.&mois..xls"DBMS=xls REPLACE;SHEET="&nom_feuille.";RUN;*//* Code permettant d'obtenir des numéros de contrats en fonction du code support saisi*/data test1;set pm;where codsup='96904' and codsys ne "AGIPI" and codsys ne "AGIPIO";contrat = cats(numctv," ");run;data test2;set mv;where codsup='B1043' and codsys ne "AGIPI" and codsys ne "AGIPIO";contrat = cats(numctv," ");run;
