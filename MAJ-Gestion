%let an=16;%let mois=10;%let an1=16;%let mois1=09;%let identifiant=s623483;%let mdp=66ekjrna;/*%let chemin=//prnas01/3/chnrs5_dtvi/eQUIPES/Produits & Normes/Aubonnet_N - equipe/17 - Stats Produits/SAS/Etude/Import;*/%let chemin=//prnas01/3/chnrs5_dtvi/eQUIPES/Produits & Normes/Aubonnet_N - equipe/17 - Stats Produits/SAS/Etude/Import;%let nom_fichier=type_gestion&an.&mois.;%let nom_feuille=base;PROC IMPORT OUT=gestionDATAFILE= "~/NAS/M/eQUIPES/Produits & Normes/Aubonnet_N - equipe/17 - Stats Produits/SAS/Etude/Import/type_gestion&an1.&mois1..xls"DBMS=XLS REPLACE; GETNAMES=YES;RUN;/* On récupère les PM*/%macro recup_pm(an=,mois=,no_lancement=,pole=,table=); libname temp "/mutu/FR/batch/data/prod/IF12/VIE/I&pole.300/&table./M&an.&mois." access=readonly; data pm&no_lancement.; set temp.pm(keep=codprod profil_gest /*gesprofi*/); run;%mend;%recup_pm(an=&an.,mois=&mois.,no_lancement=1,pole=AA,table=VISTAINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=2,pole=CO,table=VISTAINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=3,pole=CU,table=VISTAINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=4,pole=RS,table=VISTAINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=5,pole=AA,table=VISDTINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=6,pole=AA,table=ILISINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=7,pole=CO,table=ILISINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=8,pole=CU,table=ILISINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=9,pole=RS,table=ILISINV);%recup_pm(an=&an.,mois=&mois.,no_lancement=10,pole=AA,table=AGIPI);%recup_pm(an=&an.,mois=&mois.,no_lancement=11,pole=CO,table=AGIPI);data pm_stc;set pm1 pm2 pm3 pm4 pm5 pm6 pm7 pm8 pm9 pm10 pm11;run;/***************************************************************Base RCV**************************************/%macro recup_pm(an=,mois=,no_lancement=,pole=,table=); libname temp "/mutu/FR/batch/data/prod/IF12/VIE/I&pole.300/&table./M&an.&mois." access=readonly; data pm&no_lancement.; set temp.pm(keep=codprod gesprofi); run;%mend;%recup_pm(an=&an.,mois=&mois.,no_lancement=12,pole=AA,table=ILDTINV);*%recup_pm(an=&an.,mois=&mois.,no_lancement=13,pole=AA,table=RCVPM);*%recup_pm(an=&an.,mois=&mois.,no_lancement=14,pole=CO,table=RCVPM);*%recup_pm(an=&an.,mois=&mois.,no_lancement=15,pole=CU,table=RCVPM);data pm_rcv (rename= gesprofi=profil_gest);set pm12 /*pm13 pm14 pm15*/;run;/****************************************** consolidation de table pm_stc pm_rcv*************************************/data pm;set pm_stc pm_rcv;run; /********************************************************************************************************************/proc sort data=pm nodupkey;by codprod profil_gest /*gesprofi*/;run;proc sort data=gestion;by codprod profil_gest /*gesprofi*/;run;data pm_2;merge pm(in=a) gestion(in=b);by codprod profil_gest /*gesprofi*/;if a or b;run;libname axv4 "/mutu/FR/batch/data/prod/IF12/VIE/IAF160/SAXO/INVSTOCK/M20&an.&mois." access=readonly;data pm_axv4(keep=codprod mandat_de_gestion_collectif mandat_de_gestion_personnalise);set axv4.saxostock(rename=(reseau=res));codprod=code_produit;libprod=nom_produit;run;proc sort data=pm_axv4 nodupkey;by codprod  mandat_de_gestion_collectif mandat_de_gestion_personnalise;run;proc sort data=pm_2;by codprod  mandat_de_gestion_collectif mandat_de_gestion_personnalise;run;data pm_3;merge pm_2(in=a) pm_axv4(in=b);by codprod  mandat_de_gestion_collectif mandat_de_gestion_personnalise;if a or b;run;libname axv1 "/mutu/FR/batch/data/prod/IF12/VIE/IAF300/AXIOMINV/M&an.&mois." access=readonly;data pm_axv1(keep=codprod mandat_de_gestion);set axv1.go_sa (keep = canal_aramis numero_contrat CODE_PORTEFEUILLE date_effet_contrat VAL_ACQUISE_CLOT_MONTANT code_isin vl_clot mandat_de_gestion nom_support place_cotation DATE_NAISSANCE_PREMIER_ASSURE situation_cloture) axv1.go_mu (keep = canal_aramis numero_contrat CODE_PORTEFEUILLE date_effet_contrat VAL_ACQUISE_CLOT_MONTANT code_isin vl_clot mandat_de_gestion nom_support place_cotation DATE_NAISSANCE_PREMIER_ASSURE situation_cloture) axv1.thema (keep = canal_aramis numero_contrat CODE_PORTEFEUILLE date_effet_contrat VAL_ACQUISE_CLOT_MONTANT code_isin vl_clot mandat_de_gestion nom_support place_cotation DATE_NAISSANCE_PREMIER_ASSURE situation_cloture) axv1.axiva (keep = canal_aramis numero_contrat CODE_PORTEFEUILLE date_effet_contrat VAL_ACQUISE_CLOT_MONTANT code_isin vl_clot mandat_de_gestion nom_support place_cotation DATE_NAISSANCE_PREMIER_ASSURE situation_cloture) axv1.argovie (keep = canal_aramis numero_contrat CODE_PORTEFEUILLE date_effet_contrat VAL_ACQUISE_CLOT_MONTANT code_isin vl_clot mandat_de_gestion nom_support place_cotation DATE_NAISSANCE_PREMIER_ASSURE situation_cloture); format codprod $5.;  codprod=scan(numero_contrat,1,"/");run;proc sort data=pm_axv1 nodupkey;by codprod mandat_de_gestion;run;proc sort data=pm_3;by codprod mandat_de_gestion;run;data pm_4;merge pm_3(in=a) pm_axv1(in=b);by codprod mandat_de_gestion;if a or b;run;proc export data=pm_4  OUTFILE= "~/NAS/M/eQUIPES/Produits & Normes/Aubonnet_N - equipe/17 - Stats Produits/SAS/Etude/Import/type_gestion&an.&mois.._bis.xlsx" DBMS=xlsx REPLACE; sheet="base"; run;%macro recup_pm2(an=,mois=,no_lancement=,pole=,table=); libname temp "/mutu/FR/batch/data/prod/IF12/VIE/I&pole.300/&table./M&an.&mois." access=readonly; data temp_pm; set temp.pm(keep=numctv profil_gest codsys/*gesprofi*/); run;  proc sort data=temp_pm; by numctv; run; data pm&no_lancement.; set temp.pms(keep=codprod codsup resf numctv reseau codsys); run; proc sort data=pm&no_lancement.; by numctv; run; data pm&no_lancement.; merge pm&no_lancement.(in=a) temp_pm(in=b); by numctv; if a; run;%mend;%recup_pm2(an=&an.,mois=&mois.,no_lancement=1,pole=AA,table=VISTAINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=2,pole=CO,table=VISTAINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=3,pole=CU,table=VISTAINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=4,pole=RS,table=VISTAINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=5,pole=AA,table=VISDTINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=6,pole=AA,table=ILISINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=7,pole=CO,table=ILISINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=8,pole=CU,table=ILISINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=9,pole=RS,table=ILISINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=10,pole=AA,table=ILDTINV);%recup_pm2(an=&an.,mois=&mois.,no_lancement=11,pole=AA,table=AGIPI);%recup_pm2(an=&an.,mois=&mois.,no_lancement=12,pole=CO,table=AGIPI);data pm_stc_2;set pm1 pm2 pm3 pm4 pm5 pm6 pm7 pm8 pm9 pm10 pm11 pm12;run;/**************************************Base RCV_2*****************************//*%macro recup_pm2(an=,mois=,no_lancement=,pole=,table=); libname temp "/mutu/FR/batch/data/prod/IF12/VIE/I&pole.300/&table./M&an.&mois." access=readonly; data temp_pm; set temp.pm(keep=numctv gesprofi); run;  proc sort data=temp_pm; by numctv; run; data pm&no_lancement.; set temp.pms(keep=codprod codsup resf numctv reseau); run; proc sort data=pm&no_lancement.; by numctv; run; data pm&no_lancement.; merge pm&no_lancement.(in=a) temp_pm(in=b); by numctv; if a; run;%mend;%recup_pm2(an=&an.,mois=&mois.,no_lancement=13,pole=AA,table=RCVPM);%recup_pm2(an=&an.,mois=&mois.,no_lancement=14,pole=CO,table=RCVPM);%recup_pm2(an=&an.,mois=&mois.,no_lancement=15,pole=CU,table=RCVPM);data pm_rcv_2(rename=gesprofi=profil_gest);set pm13 pm14 pm15;run;*/data pm;set pm_stc_2 /*pm_rcv_2*/;run;proc sort data=pm;by codprod profil_gest /*gesprofi*/ codsup;run;proc summary data=pm;by codprod profil_gest /*gesprofi*/ codsup;var resf;output out=pm_sum sum=;run;PROC IMPORT OUT=supportDATAFILE= "~/NAS/M/eQUIPES/Produits & Normes/Aubonnet_N - equipe/17 - Stats Produits/SAS/Etude/Import/support&an.&mois..xls"DBMS=XLS REPLACE; GETNAMES=YES;RUN;proc sort data=pm_sum;by codsup;run;proc sort data=support;by codsup;run;data pm_sum2;merge pm_sum(in=a) support(in=b);by codsup;if a;run;proc sort data=pm_sum2;by codprod profil_gest codsup;run;proc export data=pm_sum2 OUTFILE= "~/NAS/M/eQUIPES/Produits & Normes/Aubonnet_N - equipe/17 - Stats Produits/SAS/Etude/Import/type_gestion&an.&mois.._bis.xlsx" DBMS=xlsx REPLACE; sheet="Aide MAJ"; run;/*Test nom produit Axiome V4;*/data test1;set gestion;where codprod='96274';run;data test;set axv4.saxostock;where code_produit='900';run;data test;set pm;where codprod in ("95714" "95744" "95754" "95764" "95784")/*9579495794958049580495804958049581495814958249582495834958349584495844958449627496294*/and resf ne 0;run;proc sort data=test;by codprod;run;proc summary data=test print; var resf;run;
